
<script type="text/JavaScript">
<!--



function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}
//-->
</script>
<script type="text/JavaScript">
<!--
function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}

function MM_findObj(n, d) { //v4.01
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && d.getElementById) x=d.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}
//-->
</script><body onLoad="MM_preloadImages('images/paging_over_01.gif','images/paging_over_03.gif')">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td valign="top">&nbsp;</td>
    <td></td>
  </tr>
  <tr>
    <td width="4%" height="400" valign="top">&nbsp;</td>
    <td width="92%" align="left" valign="top"><table width="96%" border="0" align="left" cellpadding="0" cellspacing="0">
      <tr>
        <td><img src="images/box_01.jpg" width="24" height="30" alt="" /></td>
        <td background="images/box_02.jpg"><span class="box_title_text"> Restaurant Order List </span></td>
        <td><img src="images/box_03.jpg" width="21" height="30" alt="" /></td>
      </tr>
      <tr>
        <td background="images/box_04.jpg">&nbsp;</td>
        <td width="100%" valign="top"><table width="100%" border="0" cellspacing="1" cellpadding="1"  class="bodytext">
            <tr>
              <td>&nbsp;</td>
            </tr>
            <tr>
              <td></td>
            </tr>
            <tr>
              <td width="81%" valign="top" bgcolor="#F0F0F0"><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
                <tr>
                  <td>&nbsp;</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                </tr>
                <tr>
                  <td><form action="index.php?action=allretaurant_orderlist&tabm=actd" method="post" name="orderlist" id="orderlist">
                      <table width="98%" border="0" align="center" cellpadding="2" cellspacing="1" class="bodytext">
                        <tr>
                          <td width="13%" class="bodytext"><strong>Restaurant Name:</strong></td>
                          <td width="18%" class="bodytext"><input name="rname"  id="rname" value="<? echo $d ?>" size="20" /></td>
                          <?Php $d=date('Y-m-d'); ?>
                          <td width="14%" class="bodytext"><strong>Show orders From:</strong> </td>
                          <td width="19%"><input name="sdate"  id="sdate" value="" size="12" />
                              <a href="javascript:void(0)" onClick="if(self.gfPop)gfPop.fPopCalendar(document.orderlist.sdate);return false;" ><img class="PopcalTrigger" align="top" src="calander/calbtn.gif" width="34" height="22" border="0" alt=""  /></td>
                          <td width="3%"><strong>To</strong></td>
                          <td width="20%"><input name="edate"  id="edate" value="" size="12"/>
                              <a href="javascript:void(0)" onClick="if(self.gfPop)gfPop.fPopCalendar(document.orderlist.edate);return false;" ><img class="PopcalTrigger" align="absmiddle" src="calander/calbtn.gif" width="34" height="22" border="0" alt="" /></td>
                          <td width="13%"><input type="submit" name="Submit"  class="button_grn"  value="Search" /></td>
                        </tr>
                      </table>
                  </form></td>
                </tr>
                
                <?php if($message!=""){?>
                <tr>
                  <td align="center" class="message"><?php echo $message;?></td>
                </tr>
                <?php }?>
                <tr>
                  <td><a href="index.php?action=allretaurant_orderlist" class="nav"><strong>Show All</strong></a></td>
                </tr>
                
                <tr>
                  <td><table width="100%" border="0" cellpadding="4" cellspacing="0" bgcolor="#DFDFDF" class="bodytext">
                      <!--<tr border=0> 
          <td colspan="10" class="fieldtext"></td>
        </tr> -->
                      <tr>
                        <td width="21" bgcolor="#F0F0F0" class="fieldtext" ><strong>SI </strong></td>
                        <td width="64" bgcolor="#F0F0F0" class="fieldtext" ><strong>Order No </strong></td>
                        <td width="193" bgcolor="#F0F0F0" class="fieldtext" ><strong>Name </strong></td>
                        <td width="167"  align="center" bgcolor="#F0F0F0" class="fieldtext"><strong> Restaurant Name </strong></td>
                        <td width="167" align="right" bgcolor="#F0F0F0" class="fieldtext"><strong> Amount </strong></td>
                        <td width="183" align="center" bgcolor="#F0F0F0" class="fieldtext"><strong>Payment Status</strong></td>
                        <td width="171" bgcolor="#F0F0F0" class="fieldtext"><strong>Delivery Status </strong></td>
                        </tr>
                      <?php
		$rids=$_SESSION['resid'];
			
				if ( $_REQUEST["rname"]=="" and $_REQUEST["sdate"]!="" and $_REQUEST["edate"]!="" ){
				
					$query="SELECT
							customer_order.*,
							resturant.rname
							FROM
							customer_order
							Inner Join resturant ON customer_order.rid = resturant.rid
							WHERE
							customer_order.ordate BETWEEN  '".$_REQUEST["sdate"]."' AND '".$_REQUEST["edate"]."'
							ORDER BY
							customer_order.orid DESC";
							
							$total_query = "SELECT count(*) FROM
							customer_order
							Inner Join resturant ON customer_order.rid = resturant.rid
							WHERE
							customer_order.ordate BETWEEN  '".$_REQUEST["sdate"]."' AND '".$_REQUEST["edate"]."'
							ORDER BY
							customer_order.orid DESC";
							
				}elseif ( $_REQUEST["rname"]!="" and $_REQUEST["sdate"]!="" and $_REQUEST["edate"]!="" ){
				
					$query="SELECT
							customer_order.*,
							resturant.rname
							FROM
							customer_order
							Inner Join resturant ON customer_order.rid = resturant.rid
							WHERE
							customer_order.ordate BETWEEN  '".$_REQUEST["sdate"]."' AND '".$_REQUEST["edate"]."'
							AND resturant.rname LIKE '%".$_REQUEST["rname"]."%'
							ORDER BY
							customer_order.orid DESC";
							
							$total_query = "SELECT count(*) FROM
							customer_order
							Inner Join resturant ON customer_order.rid = resturant.rid
							WHERE
							customer_order.ordate BETWEEN  '".$_REQUEST["sdate"]."' AND '".$_REQUEST["edate"]."'
							AND resturant.rname LIKE '%".$_REQUEST["rname"]."%'
							ORDER BY
							customer_order.orid DESC";
							
							
							
				}elseif ( $_REQUEST["rname"]!="" and $_REQUEST["sdate"]=="" and $_REQUEST["edate"]=="" ){
				
					$query="SELECT
							customer_order.*,
							resturant.rname
							FROM
							customer_order
							Inner Join resturant ON customer_order.rid = resturant.rid
							WHERE
							resturant.rname LIKE '%".$_REQUEST["rname"]."%'
							ORDER BY
							customer_order.orid DESC";
							
							$total_query = "SELECT count(*) FROM
							customer_order
							Inner Join resturant ON customer_order.rid = resturant.rid
							WHERE
							resturant.rname LIKE '%".$_REQUEST["rname"]."%'
							ORDER BY
							customer_order.orid DESC";
							

				}else{
					$query="SELECT
							`customer_order`.*,
							`resturant`.`rname`
  							 FROM
							`customer_order`
							 Inner Join `resturant` ON `customer_order`.`rid` = `resturant`.`rid`
							 order by orid desc";
							 
							 $total_query = "SELECT count(*) FROM
							`customer_order`
							 Inner Join `resturant` ON `customer_order`.`rid` = `resturant`.`rid`
							 order by orid desc";
				}
				
				
				 $ref = $db->execQuery($total_query);
				$total = $db->result($ref);
				
					$targetpage = "index.php?action=allretaurant_orderlist&tabm=actd"; 	//your file name  (the name of this file)
					$targetpage .= $query_string;
					$limit = 50; 								//how many items to show per page
					$page = $_REQUEST['page'];
					if($page) 
						$start = ($page - 1) * $limit; 			//first item to display on this page
					else
						$start = 0;								//if no page var is given, set start to 0
						
					
				$pagination = pagination($targetpage, $total, $page, $limit);
				// pagination end	
				
				
			
		
		$success = $db->checkExists($query);
		if ($success == true){
			$qty=10;
			
			$query.=" LIMIT $start, $limit";
			
			$result = $db->execQuery($query);
			$arinfo = $db->resultArray($result);
			//print_r($arinfo);
		//	print_r($arinfo);
			if ($_REQUEST["stq"]==""){
			 $stq=0;
			}else{
			 $stq=$_REQUEST["stq"];
			}
			$v=($stq/$qty)+1;
			if (sizeof($arinfo)>1){
				$ste=$stq+$qty;
				$st2=sizeof($arinfo) % $qty;
				
				if ($ste > sizeof($arinfo)){
					$ste=sizeof($arinfo);
				}
				$st1=(sizeof($arinfo)-$st2)/$qty;
				for ($z=0; $z <= $st1 ; $z++){
				
				if ($v==($z+1)){
					$pageIn.=($z+1);
				}else{
				$pageIn.="<a href=index.php?action=allretaurant_orderlist&stq=".($z*$qty)."&h=".$h." class=nav1>".($z+1)."</a>";
				}
				}
			}else{
				$ste=sizeof($arinfo);
			}
			for ($i = 0; $i < sizeof($arinfo); $i++)
			{
			
				$cuid=$arinfo[$i]['customers_id'];	
				$sqlc="Select * from customers where customers_id=$cuid";
				$resultc=mysql_query($sqlc);
				$rowc=mysql_fetch_array($resultc);
			
		?>
                      <tr >
                        <td width="21" valign="top" bgcolor="#FFFFFF"><?php echo $i+$start+1; ?></td>
                        <td width="64" align="center" valign="top" bgcolor="#FFFFFF"><a href="index.php?action=morderdetails&orid=<? echo $arinfo[$i]["orid"]; ?>" class="nav"><?php echo $arinfo[$i]["orid"]; ?></a></td>
                        <td width="193" valign="top" bgcolor="#FFFFFF"><a href="index.php?action=morderdetails&orid=<? echo $arinfo[$i]["orid"]; ?>" class="nav"><?php echo $rowc["customers_firstname"]; ?> <?php echo $rowc["customers_lastname"]; ?></a></td>
                        <!--<td width="62"><?php //echo $arimageinfo[0]["ImgURL"]; ?></td>-->
					 <td bgcolor="#FFFFFF" valign="top" ><?=$arinfo[$i]['rname']?></td>
                        <td align="right" valign="top" bgcolor="#FFFFFF">&pound;&nbsp;<?php 
					$tcalid=$arinfo[$i]["orid"];
					$sqltpr="select sum(uprice*qantity) as tprice from order_detail where orid='$tcalid'";
					$resulttpr=mysql_query($sqltpr);
					$rowprt=mysql_fetch_array($resulttpr);
					echo $rowprt["tprice"];
					 ?></td>

                        <td align="center" valign="top" bgcolor="#FFFFFF"><?php if ($arinfo[$i]["pstatus"]=="0"){?>
						  <a href="index.php?action=paystatus_update&tabm=rcttb&ps=y&orid=<? echo $arinfo[$i]["orid"];?>&pg=allro" class="nav6">Not Paid</a>						<?}else{?> <a href="index.php?action=paystatus_update&tabm=rcttb&ps=N&orid=<? echo $arinfo[$i]["orid"];?>&pg=allro" class="nav6">Paid</a> <?}?></td>
                        <td valign="top" bgcolor="#FFFFFF"><?php if ($arinfo[$i]["dstatus"]=="0"){?>
						  <a href="index.php?action=delevary_update&tabm=rcttb&ds=y&orid=<? echo $arinfo[$i]["orid"];?>&pg=allro" class="nav6">Not Delivered</a>						
                          <?}else{?>
                          <a href="index.php?action=delevary_update&tabm=rcttb&ds=N&orid=<? echo $arinfo[$i]["orid"];?>&pg=allro" class="nav6">Delivered</a>                          <? }?></td>
                        </tr>
                      <?php
	   }
	}
	?>
                  </table></td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                </tr>
                <tr>
                  <td align="center" ><?
	/*if ($v > 0){
		echo ("<samp  class=bodytext>Page ".$v." Of ".$z."</samp>");
	}*/
	?>                  </td>
                </tr>
                <tr>
                  <td align="center" >
				  <?php echo $pagination;?>
				  
				  <!--<table width="60%" border="0" align="center" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
                    <tr>
                      <td><?php
		if ($v>1){
		?>
                          <a class="nav1" href="index.php?action=allretaurant_orderlist&tabm=actd&amp;stq=<?php echo(($v-2)*$qty)?>&amp;h=1" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('a','','images/paging_over_01.gif',1)"><img src="images/paging_01.gif" name="a" width="30" height="32" border="0" id="a" /> </a>
                          <?php
		}else{ ?>
                          <img src="images/paging_01.gif" height="32" border="0" />
                          <?}
		?>                      </td>
                      <td width="100%" background="images/paging_body.gif" height="32" align="center" class="bodytext"><? echo ("Pages- ".$pageIn);?></td>
                      <td><?php
		 if ($v <$z){
		 ?>
                          <a class="nav1" href="index.php?action=allretaurant_orderlist&tabm=actd&amp;stq=<?php echo(($v)*$qty)?>&amp;h=1" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('b','','images/paging_over_03.gif',1)"><img src="images/paging_03.gif" name="b" width="30" height="32" border="0" id="b" /></a>
                          <?php
		 }else{ ?>
                          <img src="images/paging_03.gif" width="30" height="32" border="0" />
                          <?}
		 ?>                      </td>
                    </tr>
                  </table>-->
				  </td>
                </tr>
                <tr>
                  <td align="center" >&nbsp;</td>
                </tr>
  
              </table>                </td>
            </tr>
            
            <tr>
              <td>&nbsp;</td>
            </tr>
        </table></td>
        <td background="images/box_06.jpg">&nbsp;</td>
      </tr>
      <tr>
        <td><img src="images/box_07.jpg" width="24" height="31" alt="" /></td>
        <td background="images/box_08.jpg">&nbsp;</td>
        <td><img src="images/box_09.jpg" width="21" height="31" alt="" /></td>
      </tr><iframe width=174 height=189 name="gToday:normal:agenda.js" id="gToday:normal:agenda.js" src="calander/ipopeng.htm" scrolling="no" frameborder="0" style="visibility:visible; z-index:999; position:absolute; top:-500px; left:-500px;">
    </table></td>
  </tr>

</table>
